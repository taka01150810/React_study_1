<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    ul { list-style: none; }
    .done { text-decoration: line-through; }
   </style>
</head>
<body>
  <div id="app"></div>
  
  <script type="text/babel">
    const container = document.getElementById('app')
    const root = ReactDOM.createRoot(container)
    
    const TodoList = () => {
      const useState = React.useState
      const useEffect = React.useEffect

      const [ item, setItem ] = useState('')
      // オブジェクトの配列で持たせる
      const [ todos, setTodo ] = useState([
        { item: 'あああ', isDone: false }
      ])

      const [ searchValue, setSearchValue ] = useState('')
      const [ filteredList, setFilteredList ] = useState([])
  
      // 追加用関数
      const addItem = () => {
        // 空だったら処理を終わらせる
        if(!item) return
        // 新しいオブジェクト生成
        const newTodo = {
          item,
          isDone: false
        }
        // スプレッド構文で配列に追加
        setTodo([
          ...todos,
          newTodo
        ])
        // 入力ボックスをリセット
        setItem('')
      }

      // indexと同じでなかったら新しい配列に追加
      // filter()の第２引数は配列のインデックスを取得できる
      const deleteItem = id => {
        const newList = todos.filter((todo, index) => id !== index ? todo : null )
        setTodo(newList)
      }

      const handleChange = (id, e) => {
        // filterの第２引数は配列のインデックス
        const newList = todos.filter((todo, index) => {
          if(id === index){
            todo.isDone = e.target.checked
            return todo
          } else {
            return todo
          }
        })
        setTodo(newList)
      }

      // searchValue変更時にuseEffect実行される
      useEffect(()=>{
        // 検索機能
        const newList = todos.filter( todo => {
          return todo.item.indexOf(searchValue) !== -1
        })
        // 検索結果をsetFilteredListで更新
        setFilteredList(newList)
      }, [searchValue])

      return (<>
      {/* 引数にeでイベントオブジェクトを取得できる */}
      <input type="text" value={item} onChange={e => setItem( item => item = e.target.value )} />
      <button onClick={addItem}>追加</button>
      <input type="text" value={searchValue} onChange={e => setSearchValue(e.target.value)} />

      <ul>
        {/* 検索結果が空の場合は元のリストを表示 */}
        { !searchValue ? todos.map(( todo, index) => (
          <li>
            <input type="checkbox" checked={ todo.isDone} onChange={ e => handleChange(index, e)} />
            <span className={ todo.isDone && 'done'}>{ todo.item }</span>
            <button onClick={()=> deleteItem(index)}>削除</button>
          </li>
        )) : null }
        {/* 検索結果がある場合は検索結果のリストを表示 */}
        { searchValue ? filteredList.map(( todo, index) => (
          <li>
            <input type="checkbox" checked={ todo.isDone} onChange={ e => handleChange(index, e)} />
            <span className={ todo.isDone && 'done'}>{ todo.item }</span>
            <button onClick={()=> deleteItem(index)}>削除</button>
          </li>
        )) : null }
      </ul>

      </>)
    }

    root.render(<>
    <TodoList />
    </>)
  </script>

</body>
</html>